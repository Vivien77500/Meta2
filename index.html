<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR Player Pro 2025 - 180/360 Auto</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --line-clamp: 2; }

    body { margin:0; font-family:system-ui,-apple-system,sans-serif; background:#000; color:white; }
    .vr-bg { background: linear-gradient(135deg, #1e0533 0%, #2d0b59 50%, #000 100%); min-height:100vh; }

    .video-wrapper {
      position:relative; width:100%; max-width:1400px; margin:2rem auto;
      aspect-ratio:16/9; background:#000; border-radius:20px; overflow:hidden;
      box-shadow:0 25px 70px rgba(80,0,200,0.5);
    }
    video { width:100%; height:100%; object-fit:cover; }

    .results-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(300px,1fr)); gap:1.5rem; padding:1rem; }

    .thumb-card {
      position:relative; border-radius:18px; overflow:hidden; cursor:pointer;
      background:#111; transition:transform .3s, box-shadow .3s;
    }
    .thumb-card:hover { transform:scale(1.06); box-shadow:0 20px 50px rgba(147,51,234,0.7); }

    .badge-vr {
      position:absolute; top:12px; left:12px; z-index:10;
      padding:6px 14px; border-radius:999px; font-weight:900; font-size:13px;
      background:linear-gradient(45deg,#a855f7,#ec4899); color:white;
      backdrop-filter:blur(10px); box-shadow:0 4px 15px rgba(0,0,0,0.4);
    }

    /* Line Clamp – 100% compatible tous navigateurs (y compris Quest Browser) */
    .line-clamp-2 {
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      line-clamp: 2;
      -webkit-line-clamp: 2;
      box-orient: vertical;
    }
  </style>
</head>
<body class="vr-bg">

  <div class="max-w-7xl mx-auto p-6">

    <h1 class="text-center text-5xl md:text-7xl font-black mt-12 mb-4 tracking-tighter">
      VR PLAYER PRO
    </h1>
    <p class="text-center text-xl opacity-90 mb-12">Détection automatique 180° • 360° • VR180 • SBS</p>

    <!-- Recherche -->
    <div class="bg-white/10 backdrop-blur-2xl rounded-3xl p-8 mb-12 shadow-2xl border border-white/20">
      <div class="flex flex-col md:flex-row gap-5">
        <input type="text" id="query" placeholder="Ex: vr 180 pov japanese oculus sbs..."
               class="flex-1 px-7 py-5 rounded-2xl bg-white/20 border border-white/30 focus:border-purple-500 focus:outline-none text-white text-lg placeholder-white/70">
        <select id="site" class="px-7 py-5 rounded-2xl bg-white/20 border border-white/30 text-white text-lg">
          <option value="pornhub">Pornhub</option>
          <option value="xvideos">Xvideos</option>
          <option value="youporn">YouPorn</option>
          <option value="redgifs">RedGifs</option>
          <option value="vrporn">VRPorn.com</option>
          <option value="youtube">YouTube</option>
        </select>
        <button id="search" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-12 py-5 rounded-2xl font-black text-xl shadow-2xl transition">
          RECHERCHER
        </button>
      </div>
    </div>

    <div id="results" class="results-grid"></div>

    <div class="video-wrapper">
      <video id="player" controls crossorigin playsinline preload="none"></video>
      <div id="vr-badge" class="badge-vr hidden">180°/360° ACTIVÉ</div>
    </div>

    <div class="text-center my-12">
      <button id="fs" class="hidden bg-gradient-to-r from-pink-600 to-purple-700 hover:to-purple-900 text-white font-black text-3xl px-20 py-7 rounded-full shadow-2xl transition-all">
        MODE VR IMMERSIF
      </button>
    </div>

  </div>

  <script>
    const player = document.getElementById('player');
    const results = document.getElementById('results');
    const query = document.getElementById('query');
    const site = document.getElementById('site');
    const fs = document.getElementById('fs');
    const vrBadge = document.getElementById('vr-badge');

    const vrKeywords = ['180','360','vr180','vr360','sbs','side by side','over under','ou','vr porn','virtual reality','spherical','equirectangular','fisheye'];

    function isVR(title = '', tags = '') {
      const text = (title + ' ' + tags).toLowerCase();
      return vrKeywords.some(k => text.includes(k));
    }

    function createCard(video) {
      const vr = isVR(video.title, video.tags || '');
      const card = document.createElement('div');
      card.className = 'thumb-card';
      card.innerHTML = `
        <img src="${video.thumb||video.thumbnail||'https://via.placeholder.com/600x338/111/fff?text=NO+PREVIEW'}" class="w-full h-60 object-cover">
        ${vr ? '<div class="badge-vr">180°/360°</div>' : ''}
        <div class="p-5 bg-gradient-to-t from-black/90 to-transparent">
          <p class="font-black text-base line-clamp-2">${video.title||'Sans titre'}</p>
          <p class="text-sm opacity-75 mt-3">
            ${video.duration||''} ${video.views ? '• '+formatViews(video.views) : ''}
          </p>
        </div>
      `;
      card.onclick = () => loadVideo(video.url||video.link||video.videoUrl, vr);
      return card;
    }

    async function search() {
      const q = query.value.trim();
      if (!q) return toast('Tape quelque chose !');

      results.innerHTML = `<p class="col-span-full text-center text-3xl py-32 opacity-60">Recherche en cours...</p>`;

      try {
        const r = await fetch(`https://vrsearch.vercel.app/api/search?q=${encodeURIComponent(q)}&site=${site.value}`);
        const data = await r.json();

        results.innerHTML = '';
        if (!data || data.length===0) {
          results.innerHTML = `<p class="col-span-full text-center text-3xl py-32 text-red-400">Aucun résultat</p>`;
          return;
        }
        data.slice(0,40).forEach(v => results.appendChild(createCard(v)));
      } catch {
        results.innerHTML = `<p class="col-span-full text-center text-3xl py-32 text-red-400">Service temporairement HS<br>Réessaie dans 2 min !</p>`;
      }
    }

    function loadVideo(url, isVR = false) {
      if (!url) return;

      player.src = url;
      player.load();

      if (isVR) {
        vrBadge.classList.remove('hidden');
        player.style.objectFit = 'cover';
      } else {
        vrBadge.classList.add('hidden');
      }

      player.play().catch(()=>{});
      fs.classList.remove('hidden');
      document.querySelector('.video-wrapper').scrollIntoView({behavior:'smooth'});
      toast(isVR ? '180°/360° détecté et activé !' : 'Vidéo chargée', 'success');
    }

    fs.onclick = () => {
      if (player.requestFullscreen) player.requestFullscreen();
      else if (player.webkitEnterFullscreen) player.webkitEnterFullscreen();
    };

    document.getElementById('search').onclick = search;
    query.addEventListener('keypress', e => { if(e.key==='Enter') search(); });

    function formatViews(n) {
      n = Number(n);
      return n >= 1e6 ? (n/1e6).toFixed(1)+'M' : n >= 1e3 ? (n/1e3).toFixed(1)+'K' : n;
    }

    function toast(msg, type='info') {
      const t = document.createElement('div');
      t.textContent = msg;
      t.className = `fixed top-8 left-1/2 -translate-x-1/2 z-50 px-10 py-5 rounded-full font-black text-xl shadow-2xl ${type==='success'?'bg-green-600':'bg-purple-600'}`;
      document.body.appendChild(t);
      setTimeout(()=>t.remove(), 3800);
    }
  </script>
</body>
</html>