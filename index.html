<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>VR Player Ultime 2025 – Corrigé & Fonctionnel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;font-family:system-ui;background:#000;color:white}
  .bg-vr{background:linear-gradient(135deg,#1a0033,#2d0b59,#000)}
  .video-wrapper{position:relative;max-width:1400px;margin:2rem auto;aspect-ratio:16/9;background:#000;border-radius:20px;overflow:hidden;box-shadow:0 30px 80px rgba(139,0,255,0.6)}
  video{width:100%;height:100%;object-fit:cover}
  .badge{position:absolute;top:12px;left:12px;z-index:10;padding:6px 14px;border-radius:999px;font-weight:900;font-size:13px;background:linear-gradient(45deg,#a855f7,#ec4899);backdrop-filter:blur(8px)}
  .card{transition:.3s;cursor:pointer;border-radius:18px;overflow:hidden;background:#111}
  .card:hover{transform:scale(1.06);box-shadow:0 20px 50px rgba(147,51,234,.7)}
  .line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-clamp:2}
</style>
</head>
<body class="bg-vr min-h-screen py-8 px-4">

<div class="max-w-7xl mx-auto text-center">
  <h1 class="text-5xl md:text-7xl font-black mb-4">VR PLAYER ULTIME</h1>
  <p class="text-xl opacity-90 mb-12">180°/360° auto • URLs directes • Proxy fiable 2025</p>

  <div class="bg-white/10 backdrop-blur-2xl rounded-3xl p-8 mb-12 inline-block">
    <div class="flex flex-col md:flex-row gap-4 max-w-4xl mx-auto">
      <input id="q" type="text" placeholder="vr 180 pov japanese sbs etc..."
             class="flex-1 px-6 py-5 rounded-2xl bg-white/20 border border-white/30 focus:border-purple-500 focus:outline-none text-lg">
      <select id="site" class="px-7 py-5 rounded-2xl bg-white/20 border border-white/30 text-lg">
        <option value="pornhub">Pornhub</option>
        <option value="xvideos">Xvideos</option>
        <option value="youporn">YouPorn</option>
        <option value="vrporn">VRPorn.com</option>
      </select>
      <button id="go" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-12 py-5 rounded-2xl font-black text-xl">
        RECHERCHER
      </button>
    </div>
  </div>

  <div id="grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 max-w-7xl mx-auto px-4"></div>

  <div class="video-wrapper">
    <video id="v" controls playsinline crossorigin="anonymous" preload="metadata"></video>
    <div id="vrbadge" class="badge hidden">180°/360° ACTIVÉ</div>
  </div>

  <div class="text-center my-12">
    <button id="fs" class="hidden bg-gradient-to-r from-pink-700 to-purple-800 hover:scale-105 text-white font-black text-3xl px-20 py-7 rounded-full shadow-2xl">
      MODE VR IMMERSIF
    </button>
  </div>
</div>

<script>
const APIs = {
  pornhub: q => `https://www.pornhub.com/video/search?search=${encodeURIComponent(q)}`,  // Page de recherche standard
  xvideos:  q => `https://www.xvideos.com/?k=${encodeURIComponent(q)}`,
  youporn:  q => `https://www.youporn.com/search?query=${encodeURIComponent(q)}`,
  vrporn:   q => `https://vrporn.com/?s=${encodeURIComponent(q)}`
};

const CORS = "https://api.codetabs.com/v1/proxy?quest=";  // Proxy fiable 2025 (5MB max, supporte video)
const player = document.getElementById('v');
const grid = document.getElementById('grid');
const vrBadge = document.getElementById('vrbadge');
const vrWords = ['180','360','vr180','vr360','sbs','side by side','ou','over under','vr porn','spherical','equirectangular'];

function isVR(t=''){ return vrWords.some(w => t.toLowerCase().includes(w)); }

function toast(m,t='info'){
  const d=document.createElement('div');
  d.textContent=m;
  d.className=`fixed top-8 left-1/2 -translate-x-1/2 z-50 px-10 py-5 rounded-full font-black text-xl ${t==='success'?'bg-green-600':'bg-purple-600'} shadow-2xl`;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),3800);
}

async function search(){
  const q = document.getElementById('q').value.trim();
  const site = document.getElementById('site').value;
  if(!q) return toast('Entre un mot-clé');

  grid.innerHTML = `<p class="col-span-full text-3xl py-32 opacity-60">Recherche en cours…</p>`;

  try {
    let url = APIs[site](q);

    // Pour Pornhub : Essaie d'abord l'API webmaster gratuite (si dispo)
    if(site === 'pornhub'){
      const apiUrl = `https://www.pornhub.com/webmasters/search?search=${encodeURIComponent(q)}&page=1`;
      try {
        const apiRes = await fetch(CORS + apiUrl);
        const apiData = await apiRes.json();
        if(apiData && apiData.videos && apiData.videos.length > 0){
          const vids = apiData.videos.map(v => ({
            title: v.title,
            thumb: v.image,
            url: v.flv_url || v.mp4_url || v.full_url,  // URL directe vidéo
            duration: v.duration
          }));
          return show(vids);
        }
      } catch(apiErr){ console.log('Fallback to scraping'); }
    }

    // Scraping HTML pour les autres
    const html = await (await fetch(CORS + url)).text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const items = [];

    // Parsing spécifique par site pour extraire URLs directes
    if(site === 'pornhub'){
      doc.querySelectorAll('li.pcVideoListItem').forEach(el => {
        const a = el.querySelector('a');
        const img = el.querySelector('img');
        const titleEl = el.querySelector('.title a');
        const title = titleEl?.textContent.trim();
        if(a && title){
          // Cherche URL directe dans data-attributes ou src video
          const videoEl = el.querySelector('video source');
          const videoUrl = videoEl ? videoEl.src : ('https://www.pornhub.com' + a.href);  // Fallback page
          items.push({
            title,
            thumb: img?.getAttribute('data-src') || img?.src || '',
            url: videoUrl,
            duration: el.querySelector('.duration')?.textContent.trim()
          });
        }
      });
    } else {
      // Générique pour Xvideos / YouPorn / VRPorn : Cherche liens vidéo directs
      doc.querySelectorAll('a[href*="/video"], a[href*="/watch"], a[title]').forEach(a => {
        const img = a.querySelector('img');
        const title = a.getAttribute('title') || a.querySelector('.title')?.textContent || 'Vidéo VR';
        if(img && title){
          // Essaie d'extraire src vidéo de la page (via fetch rapide)
          // Pour simplicité : utilise le lien page, mais on l'extraira mieux dans load()
          items.push({
            title,
            thumb: img.src || img.dataset.src || '',
            url: new URL(a.href, 'https://' + site + '.com').href  // Page pour extraction
          });
        }
      });
    }
    show(items.slice(0, 30));
  } catch(e) {
    grid.innerHTML = `<p class="col-span-full text-3xl py-32 text-red-400">Erreur réseau (CORS ou site bloqué)<br>Essaie une autre source ou VPN</p>`;
    console.error(e);
  }
}

async function extractDirectUrl(pageUrl){
  // Fonction pour extraire URL vidéo directe d'une page
  try {
    const html = await (await fetch(CORS + pageUrl)).text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    // Cherche <video> src ou source
    const videoEl = doc.querySelector('video source[src]');
    if(videoEl) return videoEl.src;
    // Fallback : data-video-url ou patterns communs
    const scripts = doc.querySelectorAll('script');
    for(let script of scripts){
      if(script.textContent.includes('mp4') || script.textContent.includes('webm')){
        const match = script.textContent.match(/"(https?:\/\/[^"]+\.(mp4|webm|ogg))"/);
        if(match) return match[1];
      }
    }
    return pageUrl;  // Ultime fallback
  } catch {
    return pageUrl;
  }
}

function show(videos){
  grid.innerHTML = '';
  videos.forEach(async v => {
    const vr = isVR(v.title);
    const directUrl = await extractDirectUrl(v.url);  // Extrait URL directe
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <img src="${v.thumb||'https://via.placeholder.com/400x225/111/fff?text=VR'}" class="w-full h-56 object-cover">
      ${vr?'<div class="badge">180/360</div>':''}
      <div class="p-4 bg-gradient-to-t from-black/90">
        <p class="font-black line-clamp-2 text-sm">${v.title||'VR Vidéo'}</p>
        <p class="text-xs opacity-70 mt-2">${v.duration||''}</p>
      </div>
    `;
    div.onclick = () => load(directUrl, vr);
    grid.appendChild(div);
  });
}

function load(url, vr = false){
  if(!url) return toast('URL invalide', 'error');
  player.src = url;
  player.load();
  if(vr){ 
    vrBadge.classList.remove('hidden'); 
    player.style.objectFit = 'cover'; 
    player.setAttribute('webkit-playsinline', 'true');
  } else { 
    vrBadge.classList.add('hidden'); 
  }
  player.play().catch(e => {
    console.error('Erreur lecture:', e);
    toast('Erreur de lecture (CORS ou format). Essaie plein écran ou VPN.', 'error');
  });
  document.getElementById('fs').classList.remove('hidden');
  document.querySelector('.video-wrapper').scrollIntoView({behavior:'smooth'});
  toast(vr ? '180°/360° activé !' : 'Vidéo chargée (clique pour play)', 'success');
}

// Événements
document.getElementById('go').onclick = search;
document.getElementById('q').addEventListener('keydown', e => { if(e.key==='Enter') search(); });
document.getElementById('fs').onclick = () => {
  if (player.requestFullscreen) player.requestFullscreen();
  else if (player.webkitEnterFullscreen) player.webkitEnterFullscreen();
};
</script>
</body>
</html>