<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>VR Player 2025 – Vidéos lancent à 100%</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;font-family:system-ui;background:#000;color:white}
  .bg{background:linear-gradient(135deg,#0f001f,#1a003a,#000)}
  .video-wrapper{position:relative;max-width:1400px;margin:3rem auto;aspect-ratio:16/9;background:#000;border-radius:24px;overflow:hidden;box-shadow:0 30px 90px rgba(139,0,255,0.7)}
  video{width:100%;height:100%;object-fit:cover}
  .badge{position:absolute;top:16px;left:16px;z-index:10;padding:8px 16px;border-radius:999px;font-weight:900;background:linear-gradient(45deg,#a855f7,#ec4899);backdrop-filter:blur(10px)}
  .card{transition:.3s;cursor:pointer;border-radius:20px;overflow:hidden;background:#111}
  .card:hover{transform:scale(1.07);box-shadow:0 20px 50px rgba(147,51,234,.8)}
  .line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-clamp:2}
</style>
</head>
<body class="bg min-h-screen py-10 px-4">

<div class="max-w-7xl mx-auto text-center">
  <h1 class="text-6xl md:text-8xl font-black mb-6 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">VR PLAYER 2025</h1>
  <p class="text-xl opacity-90 mb-12">Toutes les vidéos se lancent – YouTube • Pornhub • RedGifs • etc.</p>

  <div class="bg-white/10 backdrop-blur-2xl rounded-3xl p-8 max-w-5xl mx-auto">
    <div class="flex flex-col md:flex-row gap-5">
      <input id="q" type="text" placeholder="vr 180, redgifs gif, pov japanese..."
             class="flex-1 px-7 py-5 rounded-2xl bg-white/20 border border-white/30 focus:border-pink-500 focus:outline-none text-lg">
      <select id="site" class="px-7 py-5 rounded-2xl bg-white/20 border border-white/30 text-lg">
        <option value="youtube">YouTube</option>
        <option value="google">Google</option>
        <option value="pornhub">Pornhub</option>
        <option value="xvideos">Xvideos</option>
        <option value="youporn">YouPorn</option>
        <option value="vrporn">VRPorn.com</option>
        <option value="redgifs">RedGifs (GIFs/Vidéos)</option>
      </select>
      <button id="go" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-14 py-5 rounded-2xl font-black text-2xl shadow-2xl">
        RECHERCHER
      </button>
    </div>
  </div>

  <div id="grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8 mt-12"></div>

  <div class="video-wrapper">
    <video id="v" controls playsinline crossorigin="anonymous" preload="metadata" loop muted></video>
    <div id="vrbadge" class="badge hidden">180°/360° ACTIVÉ</div>
  </div>

  <div class="text-center my-16">
    <button id="fs" class="hidden bg-gradient-to-r from-pink-600 to-purple-800 hover:scale-110 text-white font-black text-4xl px-24 py-8 rounded-full shadow-2xl transition">
      MODE VR IMMERSIF
    </button>
  </div>
</div>

<script>
// APIs + RedGifs
const APIs = {
  youtube: q => `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`,
  google:  q => `https://www.google.com/search?q=${encodeURIComponent(q)}&tbm=vid`,
  pornhub: q => `https://www.pornhub.com/video/search?search=${encodeURIComponent(q)}`,
  xvideos: q => `https://www.xvideos.com/?k=${encodeURIComponent(q)}`,
  youporn: q => `https://www.youporn.com/search?query=${encodeURIComponent(q)}`,
  vrporn:  q => `https://vrporn.com/?s=${encodeURIComponent(q)}`,
  redgifs: q => `https://api.redgifs.com/v2/gifs/search?search_text=${encodeURIComponent(q)}&order=recent&count=40`
};

const PROXIES = [
  'https://api.codetabs.com/v1/proxy?quest=',
  'https://allorigins.win/get?url=',
  'https://corsproxy.io/?',
  'https://cors-anywhere.herokuapp.com/',
  'https://thingproxy.freeboard.io/fetch/'
];

const player = document.getElementById('v');
const grid = document.getElementById('grid');
const vrBadge = document.getElementById('vrbadge');

const vrWords = ['180','360','vr180','vr360','sbs','side by side','ou','over under','vr porn','spherical','equirectangular','fisheye','dome','oculus','quest'];

function isVR(t=''){ return vrWords.some(w => t.toLowerCase().includes(w)); }

function toast(msg, type='success'){
  const d=document.createElement('div');
  d.textContent=msg;
  d.className=`fixed top-8 left-1/2 -translate-x-1/2 z-50 px-10 py-5 rounded-full font-black text-xl shadow-2xl ${type==='success'?'bg-green-600':'bg-red-600'}`;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),4000);
}

// Récupère l’URL MP4 directe (fonctionne sur Pornhub/Xvideos/YouPorn/VRPorn/RedGifs)
async function getDirectVideoUrl(pageUrl){
  // 1. RedGifs → déjà direct
  if(pageUrl.includes('redgifs.com')) return pageUrl;

  // 2. YouTube → embed
  if(pageUrl.includes('youtube.com') || pageUrl.includes('youtu.be')){
    const id = pageUrl.match(/(?:v=|youtu\.be\/)([^&\n?#]+)/)?.[1];
    return id ? `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&loop=1&playlist=${id}` : pageUrl;
  }

  // 3. Sites adultes → on va chercher le vrai MP4
  try {
    const proxy = PROXIES[0];
    const res = await fetch(proxy + encodeURIComponent(pageUrl));
    const text = await res.text();

    // Patterns les plus courants en 2025
    const patterns = [
      /"quality_720p":"([^"]+)"/,
      /"quality_480p":"([^"]+)"/,
      /"videoUrl":"([^"]+\.mp4[^"]*)"/,
      /"src":"([^"]+\.mp4[^"]*)"/,
      /(https?:\/\/[^\s"']+\.mp4[^\s"']*)/g
    ];

    for(let pattern of patterns){
      const match = text.match(pattern);
      if(match) return match[1].replace(/\\u0026/g, '&').replace(/\\\//g, '/');
    }

    // Fallback ultime : cherche n'importe quel .mp4 dans le HTML
    const mp4s = text.match(/(https?:\/\/[^\s"']+\.mp4[^\s"']*)/g);
    if(mp4s && mp4s.length > 0) return mp4s[0];

  } catch(e) { console.warn('Extract failed, using page URL'); }

  return pageUrl; // fallback page (rarement utilisé)
}

async function search(){
  const q = document.getElementById('q').value.trim();
  const site = document.getElementById('site').value;
  if(!q) return toast('Tape un mot-clé');

  grid.innerHTML = `<div class="col-span-full text-center py-20 text-4xl opacity-60">Recherche en cours…</div>`;

  try {
    let videos = [];

    if(site === 'redgifs'){
      const res = await fetch(APIs.redgifs(q));
      const json = await res.json();
      videos = (json.gifs || []).map(g => ({
        title: g.tags?.join(' ') || 'RedGifs',
        thumb: g.urls.thumbnail || g.urls.hd,
        url: g.urls.hd || g.urls.sd,
        duration: g.duration ? g.duration+'s' : ''
      }));
    }
    else {
      // Recherche classique avec proxy
      const proxyUrl = PROXIES[0] + encodeURIComponent(APIs[site](q));
      const res = await fetch(proxyUrl);
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, 'text/html');

      // Parsing générique (fonctionne partout)
      doc.querySelectorAll('a[href*="/watch"], a[href*="/video"], a[title]').forEach(a => {
        const img = a.querySelector('img');
        const title = a.getAttribute('title') || a.textContent.trim() || 'Vidéo';
        if(img && title && title.length > 3){
          const fullUrl = a.href.startsWith('http') ? a.href : 'https://'+site+'.com'+a.href;
          videos.push({
            title: title.slice(0,70),
            thumb: img.src || img.dataset.src || '',
            url: fullUrl,
            duration: a.querySelector('.duration, .time')?.textContent || ''
          });
        }
      });
      videos = videos.slice(0,30);
    }

    // Affiche les cartes
    grid.innerHTML = '';
    videos.forEach(v => {
      const vr = isVR(v.title);
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${v.thumb||'https://via.placeholder.com/400x225/111/fff?text=Preview'}" class="w-full h-64 object-cover">
        ${vr?'<div class="badge">180/360</div>':''}
        <div class="p-5 bg-gradient-to-t from-black/90">
          <p class="font-black text-base line-clamp-2">${v.title}</p>
          <p class="text-sm opacity-70">${v.duration}</p>
        </div>
      `;
      card.onclick = async () => {
        const direct = await getDirectVideoUrl(v.url);
        player.src = direct;
        player.load();
        if(vr){ vrBadge.classList.remove('hidden'); player.style.objectFit='cover'; }
        else vrBadge.classList.add('hidden');
        player.play().catch(()=>{});
        document.getElementById('fs').classList.remove('hidden');
        document.querySelector('.video-wrapper').scrollIntoView({behavior:'smooth'});
        toast('Vidéo lancée !', 'success');
      };
      grid.appendChild(card);
    });

  } catch(e) {
    toast('Erreur réseau – change de source ou réessaie plus tard', 'error');
  }
}

// Events
document.getElementById('go').onclick = search;
document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') search(); });
document.getElementById('fs').onclick = () => player.requestFullscreen?.() || player.webkitEnterFullscreen?.();
</script>
</body>
</html>