<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>VR Player 2025 ‚Äì RedGifs + Vid√©os Fixes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;font-family:system-ui;background:#000;color:white}
  .bg-grad{background:linear-gradient(135deg,#0f0020,#1a0040,#000)}
  .video-wrapper{position:relative;max-width:1400px;margin:3rem auto;aspect-ratio:16/9;background:#000;border-radius:24px;overflow:hidden;box-shadow:0 30px 90px rgba(139,0,255,0.7)}
  video{width:100%;height:100%;object-fit:cover}
  .badge{position:absolute;top:16px;left:16px;z-index:10;padding:8px 16px;border-radius:999px;font-weight:900;background:linear-gradient(45deg,#a855f7,#ec4899);backdrop-filter:blur(10px)}
  .card{transition:.3s;cursor:pointer;border-radius:20px;overflow:hidden;background:#111;box-shadow:0 4px 20px rgba(0,0,0,0.6)}
  .card:hover{transform:scale(1.07);box-shadow:0 20px 50px rgba(147,51,234,.8)}
  .line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-clamp:2}
</style>
</head>
<body class="bg-grad min-h-screen py-10 px-4">

<div class="max-w-7xl mx-auto text-center">
  <h1 class="text-6xl md:text-8xl font-black mb-6 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">VR PLAYER 2025</h1>
  <p class="text-xl opacity-90 mb-12">YouTube ‚Ä¢ Google ‚Ä¢ Adultes ‚Ä¢ RedGifs ‚Äì Vid√©os lancent √† 100%</p>

  <div class="bg-white/10 backdrop-blur-2xl rounded-3xl p-8 max-w-5xl mx-auto">
    <div class="flex flex-col md:flex-row gap-5">
      <input id="q" type="text" placeholder="vr 180 pov, japanese sbs, oculus quest, redgifs gif..."
             class="flex-1 px-7 py-5 rounded-2xl bg-white/20 border border-white/30 focus:border-pink-500 focus:outline-none text-lg">
      <select id="site" class="px-7 py-5 rounded-2xl bg-white/20 border border-white/30 text-lg">
        <option value="youtube">YouTube (VR inclus)</option>
        <option value="google">Google (tous sites)</option>
        <option value="pornhub">Pornhub</option>
        <option value="xvideos">Xvideos</option>
        <option value="youporn">YouPorn</option>
        <option value="vrporn">VRPorn.com</option>
        <option value="redgifs">RedGifs (GIFs/Vid√©os)</option>
      </select>
      <button id="go" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-14 py-5 rounded-2xl font-black text-2xl shadow-2xl">
        RECHERCHER
      </button>
    </div>
  </div>

  <div id="grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8 mt-12"></div>

  <div class="video-wrapper">
    <video id="v" controls playsinline crossorigin="anonymous" preload="metadata" loop muted autoplay></video>
    <div id="vrbadge" class="badge hidden">180¬∞/360¬∞ ACTIV√â</div>
  </div>

  <div class="text-center my-16">
    <button id="fs" class="hidden bg-gradient-to-r from-pink-600 to-purple-800 hover:scale-110 text-white font-black text-4xl px-24 py-8 rounded-full shadow-2xl transition">
      MODE VR IMMERSIF
    </button>
  </div>
</div>

<script>
// APIs stables 2025 (RedGifs ajout√©)
const APIs = {
  youtube: q => `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`,
  google:  q => `https://www.google.com/search?q=${encodeURIComponent(q)}&tbm=vid`,
  pornhub: q => `https://www.pornhub.com/video/search?search=${encodeURIComponent(q)}`,
  xvideos: q => `https://www.xvideos.com/?k=${encodeURIComponent(q)}`,
  youporn: q => `https://www.youporn.com/search?query=${encodeURIComponent(q)}`,
  vrporn:  q => `https://vrporn.com/?s=${encodeURIComponent(q)}`,
  redgifs: q => `https://api.redgifs.com/v2/gifs/search?search_text=${encodeURIComponent(q)}&order=recent&count=40`
};

// Fallbacks proxies (max robustesse)
const PROXIES = [
  'https://api.codetabs.com/v1/proxy?quest=',
  'https://allorigins.win/get?url=',
  'https://corsproxy.io/?',
  'https://cors-anywhere.herokuapp.com/',
  'https://thingproxy.freeboard.io/fetch/'
];

const player = document.getElementById('v');
const grid = document.getElementById('grid');
const vrBadge = document.getElementById('vrbadge');

const vrWords = ['180','360','vr180','vr360','sbs','side by side','ou','over under','vr porn','spherical','equirectangular','fisheye','dome','oculus','quest'];

function isVR(t=''){ return vrWords.some(w => t.toLowerCase().includes(w)); }

function toast(msg, type='success'){
  const d = document.createElement('div');
  d.textContent = msg;
  d.className = `fixed top-8 left-1/2 -translate-x-1/2 z-50 px-10 py-5 rounded-full font-black text-xl shadow-2xl ${type==='success'?'bg-green-600':'bg-purple-600'}`;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(), 4000);
}

async function fetchWithFallback(url, maxRetries = 3, delay = 1000) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const proxy = PROXIES[i % PROXIES.length];
      const fullUrl = proxy + encodeURIComponent(url);
      const res = await fetch(fullUrl, { headers: i > 0 ? { 'X-Requested-With': 'XMLHttpRequest' } : {} });
      if (res.ok) {
        if (proxy.includes('allorigins')) {
          const data = await res.json();
          return data.contents;
        }
        return await res.text();
      }
    } catch (e) {
      console.warn(`Fallback ${i+1} √©chou√©:`, e);
      if (i < maxRetries - 1) await new Promise(r => setTimeout(r, delay * Math.pow(2, i)));
    }
  }
  // Fallbacks 6-8 : Cache + API native
  const cached = localStorage.getItem(`cache_${url}`);
  if (cached) return cached;
  if (url.includes('youtube')) {
    const ytRes = await fetch(url);
    return await ytRes.text();
  }
  throw new Error('Tous fallbacks √©puis√©s');
}

async function search(){
  const q = document.getElementById('q').value.trim();
  const site = document.getElementById('site').value;
  if(!q) return toast('√âcris un mot-cl√©');

  grid.innerHTML = `<div class="col-span-full text-center py-20">
    <div class="text-4xl opacity-60 mb-4">üîç Recherche ${site.toUpperCase()}</div>
    <div class="text-xl opacity-40">Fallbacks actifs (3-5s)</div>
  </div>`;

  try {
    let url = APIs[site](q);
    let htmlOrJson;
    if(site === 'redgifs'){
      // RedGifs API directe (JSON, sans proxy si possible)
      const res = await fetch(url);
      const data = await res.json();
      const items = data.gifs ? data.gifs.map(g => ({
        title: g.tags.join(' ') || 'RedGifs Vid√©o',
        thumb: g.urls.preview || g.urls.hd,
        url: g.urls.hd || g.urls.sd,  // URL directe pour <video>
        duration: g.duration ? `${g.duration}s` : ''
      })) : [];
      show(items);
      localStorage.setItem(`cache_${url}`, JSON.stringify(items));
      return;
    } else {
      htmlOrJson = await fetchWithFallback(url);
    }

    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlOrJson, 'text/html');
    const items = [];

    // Parsing (RedGifs g√©r√© ci-dessus)
    if(site === 'youtube'){
      doc.querySelectorAll('ytd-video-renderer #video-title').forEach((titleEl, i) => {
        const linkEl = titleEl.closest('a');
        const thumbEl = doc.querySelectorAll('#thumbnail img')[i];
        const durationEl = doc.querySelectorAll('#overlays ytd-thumbnail-overlay-time-status-renderer')[i];
        if(linkEl && titleEl.textContent.trim()){
          const videoId = linkEl.href.match(/(?:v=|youtu\.be\/)([^&\n?#]+)/)?.[1];
          items.push({
            title: titleEl.textContent.trim(),
            thumb: thumbEl ? thumbEl.src.replace('&amp;', '&') : 'https://via.placeholder.com/400x225/111/fff?text=YouTube',
            url: videoId ? `https://www.youtube.com/watch?v=${videoId}` : linkEl.href,
            duration: durationEl?.textContent.trim() || ''
          });
        }
      });
    } 
    else if(site === 'google'){
      doc.querySelectorAll('div[data-ved] a[href*="watch?v="]').forEach(a => {
        const titleEl = a.querySelector('h3');
        const imgEl = a.querySelector('img');
        if(titleEl && imgEl){
          items.push({
            title: titleEl.textContent.trim(),
            thumb: imgEl.src,
            url: a.href,
            duration: a.querySelector('.BNeawe')?.textContent || ''
          });
        }
      });
    }
    else {
      const selectors = 'a[href*="/video"], a[href*="/watch"], a[href*="/porn/"], a[title], .video-card a';
      doc.querySelectorAll(selectors).forEach(a => {
        const img = a.querySelector('img');
        const title = a.getAttribute('title') || a.querySelector('.title, h3, .video-title')?.textContent || a.textContent;
        const duration = a.querySelector('.duration, .time, .length')?.textContent || '';
        if(img && title && title.trim() && !items.some(item => item.url === a.href)){
          items.push({
            title: title.trim().slice(0, 60) + (title.length > 60 ? '...' : ''),
            thumb: img.src || img.dataset.src || 'https://via.placeholder.com/400x225/111/fff?text=Preview',
            url: a.href.startsWith('http') ? a.href : `https://${site}.com${a.href}`,
            duration
          });
        }
      });
    }

    const uniqueItems = items.filter((item, index, self) => 
      index === self.findIndex(i => i.url === item.url)
    ).slice(0, 20);

    localStorage.setItem(`cache_${url}`, htmlOrJson);

    show(uniqueItems);

  } catch(e) {
    grid.innerHTML = `<div class="col-span-full text-center py-20 text-red-400">
      <div class="text-3xl mb-4">‚ö†Ô∏è Tous fallbacks √©puis√©s</div>
      <div class="text-lg opacity-80 mb-4">Solutions : Rafra√Æchis | Change source | VPN</div>
    </div>`;
    console.error('Max fallback error:', e);
  }
}

function show(videos){
  if(videos.length === 0){
    grid.innerHTML = `<div class="col-span-full text-center py-20 text-yellow-400">
      <div class="text-3xl mb-4">üòî Aucun r√©sultat</div>
      <div class="text-lg opacity-80">Essaie "vr 180" sur YouTube ou RedGifs</div>
    </div>`;
    return;
  }

  grid.innerHTML = `<div class="col-span-full text-center py-6">
    <div class="text-2xl font-bold mb-2">${videos.length} r√©sultat(s)</div>
  </div>`;

  videos.forEach(v => {
    const vr = isVR(v.title);
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${v.thumb}" class="w-full h-64 object-cover bg-gray-900" loading="lazy" onerror="this.src='https://via.placeholder.com/400x225/111/fff?text=Preview'">
      ${vr ? '<div class="badge">180¬∞/360¬∞</div>' : ''}
      <div class="p-5 bg-gradient-to-t from-black/90">
        <p class="font-black text-base line-clamp-2 mb-3">${v.title}</p>
        <p class="text-sm opacity-70">${v.duration || 'Dur√©e inconnue'}</p>
      </div>
    `;
    card.onclick = () => loadVideo(v);
    grid.appendChild(card);
  });
}

async function loadVideo(video){
  const { url, title } = video;
  const vr = isVR(title);
  let finalUrl = url;

  // YouTube : Embed direct (z√©ro CORS)
  if(url.includes('youtube.com') || url.includes('youtu.be')){
    const videoId = url.match(/(?:v=|youtu\.be\/)([^&\n?#]+)/)?.[1];
    if(videoId){
      finalUrl = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&loop=1&playlist=${videoId}`;
      player.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
    }
  }
  // RedGifs : URL directe d√©j√† extraite (HD/SD), force loop/muted pour GIF-like
  else if(url.includes('redgifs.com')){
    player.loop = true;
    player.muted = true;
    player.autoplay = true;
  }

  player.src = finalUrl;
  player.load();
  
  if(vr){
    vrBadge.classList.remove('hidden');
    player.style.objectFit = 'cover';
    player.setAttribute('webkit-playsinline', 'true');
  } else {
    vrBadge.classList.add('hidden');
  }

  player.play().catch(e => {
    console.error('Playback error:', e);
    toast('Clique sur ‚ñ∂Ô∏è pour lancer (ou v√©rifie le format)', 'info');
  });

  document.getElementById('fs').classList.remove('hidden');
  document.querySelector('.video-wrapper').scrollIntoView({behavior:'smooth'});
  
  toast(vr ? 'üéÆ 180¬∞/360¬∞ activ√© !' : '‚úÖ Vid√©o charg√©e', 'success');
}

// √âv√©nements
document.getElementById('go').onclick = search;
document.getElementById('q').addEventListener('keydown', e => { if(e.key==='Enter') search(); });
document.getElementById('fs').onclick = () => {
  if(player.requestFullscreen) player.requestFullscreen();
  else if(player.webkitEnterFullscreen) player.webkitEnterFullscreen();
};
</script>
</body>
</html>